@{
    ViewBag.Title = "taoSanPham";
    Layout = "~/Areas/QuanTri/Views/Shared/_Layout.cshtml";
}
@model ThaiSonBacDMS.Areas.PhanPhoi.Models.TaoSanPhamModel
@section IndexStyle {
    <style>
        input[type="file"] {
            display: block;
        }

        .imageThumb {
            max-height: 75px;
            border: 2px solid;
            margin: 10px 10px 0 0;
            padding: 1px;
        }

        .custom-btn {
            padding: 10px 5px;
            min-width: 80px;
            height: 55px;
        }

        .custom-chk {
            padding-left: 15px;
        }

        .menu-button {
            background-color: #fcf9f9;
            margin-top: 20px;
            padding-top: 20px;
            padding-right: 25px;
        }

        .smallBtn {
            padding: 10px 5px;
            min-width: 60px;
            height: 40px;
        }

        .chosen-container-multi .chosen-choices {
            width: 98.5% !important;
        }

            .chosen-container-multi .chosen-choices li.search-field input[type="text"] {
                height: 28px !important;
                width: 340px;
            }

        .btn-file {
            position: relative;
            overflow: hidden;
        }

            .btn-file input[type=file] {
                position: absolute;
                top: 0;
                right: 0;
                min-width: 100%;
                min-height: 100%;
                font-size: 100px;
                text-align: right;
                filter: alpha(opacity=0);
                opacity: 0;
                outline: none;
                background: white;
                cursor: inherit;
                display: block;
            }
    </style>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.1.0/chosen.css">
}

<!-- Content Header (Page header) -->
<section class="content-header">
    <ol class="breadcrumb">
        <li><a href="quantri_index.html"><i class="fa fa-dashboard"></i> Trang Chủ</a></li>
        <li>Hàng hóa</li>
        <li><a href="quantri_hanghoa_tao-san-pham.html">Thêm sản phẩm mới</a></li>
    </ol>
</section>


<!-- Main content -->
<section class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box">
                <div class="row" style="margin-left:0px; margin-right:0px; margin-top: 10px;">
                    <div class="col-md-12">
                        <h4>
                            <b>Thêm sản phẩm</b>
                        </h4>

                    </div>

                </div>
                <!-- /.box-header -->
                <div class="box">
                    <div class="box-header with-border text-center menu-button">

                        <a class="btn btn-app custom-btn" data-toggle="tooltip"  title="Tạo Mới" id="btnCreate">
                            <i class="fa fa-plus-square text-green"></i>
                            <span><strong>Tạo Mới</strong></span>
                        </a>
                        <a class="btn btn-app custom-btn disabled" data-toggle="tooltip" title="Sửa" data-placement="bottom">
                            <i class="fa fa-edit text-grey"></i>
                            <span><strong>Sửa</strong></span>
                        </a>
                        <a class="btn btn-app custom-btn" id="btnUpload" title="Lưu" data-placement="bottom">
                            <i class="fa fa-save text-yellow"></i>
                            <span><strong>Lưu</strong></span>
                        </a>
                        <a class="btn btn-app custom-btn disabled" data-toggle="tooltip" title="Hủy" data-placement="bottom">
                            <i class="fa fa-close text-grey"></i>
                            <span><strong>Hủy</strong></span>
                        </a>
                        <a class="btn btn-app custom-btn disabled" data-toggle="tooltip" title="Chốt đơn" data-placement="bottom">
                            <i class="fa fa-check-circle text-grey"></i>
                            <span><strong>Chốt đơn</strong></span>
                        </a>
                        <a class="btn btn-app custom-btn disabled" data-toggle="tooltip" title="Đổi trả" data-placement="bottom">
                            <i class="fa fa-exchange text-grey"></i>
                            <span><strong>Đổi trả</strong></span>
                        </a>
                        <a class="btn btn-app custom-btn disabled" data-toggle="tooltip" title="Xem Trước" data-placement="bottom">
                            <i class="fa fa-eye text-grey"></i>
                            <span><strong>Xem Trước</strong></span>
                        </a>
                        <a class="btn btn-app custom-btn disabled" data-toggle="tooltip" title="In" data-placement="bottom">
                            <i class="fa fa-print text-grey"></i>
                            <span><strong>In</strong></span>
                        </a>
                        <a class="btn btn-app custom-btn disable" data-toggle="tooltip" title="Import Excel" data-placement="bottom">
                            <i class="fa fa-download text-black"></i>
                            <span><strong>Import Excel</strong></span>
                        </a>
                        <a class="btn btn-app custom-btn disabled" data-toggle="tooltip" title="Xuất Excel" data-placement="bottom">
                            <i class="fa fa-file-excel-o text-grey"></i>
                            <span><strong>Xuất Excel</strong></span>
                        </a>
                        <a class="btn btn-app custom-btn disabled" data-toggle="tooltip" title="Xuất PDF" data-placement="bottom">
                            <i class="fa fa-file-pdf-o text-grey"></i>
                            <span><strong>Xuất PDF</strong></span>
                        </a>
                    </div>
                </div>
                <div class="box-body" style="padding-bottom: 50px;">
                    <div class="row">
                        <div class="col-md-12">
                            <form class="form form-vertical">
                                <div class="col-md-12">
                                    <span class="btn btn-primary btn-file">
                                        Chọn Ảnh <input type="file" class="inputfile" id="files" name="files[]" multiple />
                                    </span>
                                </div>
                                <div class="col-md-12" style="padding-top: 15px">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label>Mã máy</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-file"></i>
                                                </span>
                                                <input class="form-control" placeholder="Mã máy..." id="pCode" type="text" required />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Tên Máy</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-file"></i>
                                                </span>
                                                <input class="form-control" placeholder="Tên máy..." id="pName" type="text" required />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Thông số máy</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-file"></i>
                                                </span>
                                                <input class="form-control" placeholder="Thông số máy máy..." id="pParam" type="text" required />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 10px;">
                                        <div class="col-md-4">
                                            <label>Nhà cung cấp</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-handshake-o"></i>
                                                </span>
                                                @Html.DropDownList("pSupplier", @Model.supplierList,"Chọn nhà cung cấp",new { @class= "form-control" })
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Danh mục</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-sliders"></i>
                                                </span>
                                                @Html.DropDownList("pCategory", @Model.categoryList, "Chọn danh mục", new { @class = "form-control" })

                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Danh mục con</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-sliders"></i>
                                                </span>
                                                @Html.DropDownList("pSubCategory", @Model.subCategoryList, "Chọn danh mục con", new { @class = "form-control" })
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 10px;">
                                        <div class="col-md-4">
                                            <label>Số lượng cái/ thùng</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-money"></i>
                                                </span>
                                                <input class="form-control number" placeholder="Số lượng" id="pNumberCarton" type="number" required />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Giá trước VAT (VNĐ)</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-money"></i>
                                                </span>
                                                <input class="form-control number" placeholder="Giá tiền VNĐ" id="pBeforeVatVND" type="text" required />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Giá trước VAT (USD)</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-dollar"></i>
                                                </span>
                                                <input class="form-control number" placeholder="Giá tiền USD" id="pBeforeVatUSD" type="text" required />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 10px;">
                                        <div class="col-md-4">
                                            <label>CIF (VNĐ)</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-money"></i>
                                                </span>
                                                <input class="form-control number" placeholder="Giá tiền VNĐ" id="cifVND" type="text" required />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label>CIF (USD)</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-dollar"></i>
                                                </span>
                                                <input class="form-control number" placeholder="Giá tiền USD" id="cifUSD" type="text" required />
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label>VAT</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-dollar"></i>
                                                </span>
                                                <input class="form-control number" placeholder="Giá tiền USD" id="vat" type="text" required />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 10px;">
                                        <div class="col-md-6">
                                            <label>Tổng quan sản phẩm</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-circle-o"></i>
                                                </span>
                                                <textarea id="pDescription" class="form-control"></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label>Chi tiết sản phẩm</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa-chevron-circle-down"></i>
                                                </span>
                                                <textarea id="pDetail" class="form-control"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
            <!--main box-->
        </div>
        <!--main col-->
    </div>
    <!--main row-->
    <div class="modal fade" id="popupConfirm" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Xác nhận lưu thông tin đã nhập?</h4>
                </div>

                <div class="modal-footer" style="margin-right:15px">
                    <div style="margin:0 auto;">
                        <button id="btnSave" type="submit" style="color:white;background-color:green" class="btn btn-default">OK</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- /.content -->
@section Index {
    <!-- sweet Alert-->
    <script src="~/Assets/dist/js/sweetalert2.all.js"></script>
    <!-- page script -->
    <script>
        $(document).ready(function () {
            if (window.File && window.FileList && window.FileReader) {
                $("#files").on("change", function (e) {
                    var files = e.target.files,
                    filesLength = files.length;
                    for (var i = 0; i < filesLength ; i++) {
                        var f = files[i]
                        var fileReader = new FileReader();
                        fileReader.onload = (function (e) {
                            var file = e.target;
                            $("<img></img>", {
                                class: "imageThumb",
                                src: e.target.result,
                                title: file.name
                            }).insertAfter("#files");
                        });
                        fileReader.readAsDataURL(f);
                    }
                });
            } else { alert("Your browser doesn't support to File API") }
        });
    </script>

    <script>
        $(document).ready(function () {
            $("#btnCreate").click(function () {
                swal({
                    title: 'Lưu thông tin?',
                    text: "Bạn có muốn lưu toàn bộ thông tin!",
                    type: 'info',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Lưu',
                    cancelButtonText: 'Trở lại'
                }).then((result) => {
                    if (result.value) {
                        // Checking whether FormData is available in browser
                        if (window.FormData !== undefined) {

                            var fileUpload = $("#files").get(0);
                            var files = fileUpload.files;

                            // Create FormData object
                            var fileData = new FormData();

                            // Looping over all files and add it to FormData object
                            for (var i = 0; i < files.length; i++) {
                                fileData.append(files[i].name, files[i]);
                            }

                            // Adding one more key to FormData object

                            var pCode = $("#pCode").val();
                            var pName = $("#pName").val();
                            var pParam = $("#pParam").val();
                            var pSupplier = $('#pSupplier').val();
                            var pCategory = $('#pCategory').val();
                            var pSubCategory = $('#pSubCategory').val();
                            var pNumberCarton = $('#pNumberCarton').val();
                            var pBeforeVatVND = $('#pBeforeVatVND').val();
                            var pBeforeVatUSD = $('#pBeforeVatUSD').val();
                            var cifVND = $('#cifVND').val();
                            var cifUSD = $('#cifUSD').val();
                            var vat = $('#vat').val();
                            var pDescription = $('#pDescription').val();
                            var pDetail = $('#pDetail').val();

                            fileData.append('pCode', pCode);
                            fileData.append('pName', pName);
                            fileData.append('pParam', pParam);
                            fileData.append('pSupplier', pSupplier);
                            fileData.append('pCategory', pCategory);
                            fileData.append('pSubCategory', pSubCategory);
                            fileData.append('pNumberCarton', pNumberCarton);
                            fileData.append('pBeforeVatVND', pBeforeVatVND);
                            fileData.append('pBeforeVatUSD', pBeforeVatUSD);
                            fileData.append('cifVND', cifVND);
                            fileData.append('cifUSD', cifUSD);
                            fileData.append('vat', vat);
                            fileData.append('pDescription', pDescription);
                            fileData.append('pDetail', pDetail);
                            fileData.append('userID', @Model.userID);

                            if (isEmpty(pCode)) {
                                swal({
                                    title: 'Xin hàn thành tên sản phẩm',
                                    type: 'warning'
                                });
                            } else if (isEmpty(pName)) {
                                swal({
                                    title: 'Xin hàn thành tên sản phẩm',
                                    type: 'warning'
                                });
                            } else if (isEmpty(pParam)) {
                                swal({
                                    title: 'Xin hàn thành tên sản phẩm',
                                    type: 'warning'
                                });
                            } else {
                                $.ajax({
                                    url: '/TaoSanPham/UploadFiles',
                                    type: "POST",
                                    contentType: false, // Not to set any content header
                                    processData: false, // Not to process data
                                    data: fileData,
                                    success: function (result) {
                                        if (result == "-1") {
                                            swal(
                                                 'Lỗi',
                                                 'Có lỗi xảy ra khi tạo',
                                                 'warning'
                                            );
                                        } else if (result == "-2") {
                                            swal(
                                                 'Lỗi',
                                                 'Chưa chọn ảnh',
                                                 'warning'
                                            );
                                        } else {
                                            swal(
                                                 'Thành công',
                                                 'Bạn đã thêm sản phẩm thành công.',
                                                 'success'
                                            ).then(function () {
                                                window.location.href = 'PhanPhoi/ChiTietSanPham?product_Id=' + result;
                                            });;
                                        }
                                    },
                                    error: function (err) {
                                        swal({
                                            title: err,
                                            type: 'warning',
                                        });
                                    }
                                });
                            }
                        } else {
                            swal({
                                title: "FormData is not supported.",
                                type: 'warning',
                            });
                        }

                    }
                });
            });
        });

        function isEmpty(value) {
            return (value == null || value.length === 0);
        }
        function validateEmail(email) {
            var re = /^\w+@@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/;
            return re.test(email);
        }
    </script>
}





